## Установка PostgreSQL на Linux сервер или на Windows


PostgreSQL - это open source объектно-реляционная Систему Управления Базами Данных

<br>


Варианты установки:
- Через пакетный менеджер `Linux`
- Через github (установка с исходного кода) `Linux/Windows`
- С помощью установщика `Windows`

<br>

### Сборка PostgreSQL из исходных кодов

**Необходимое ПО:**
- curl
- tar
- gzip/bzip2
- GNU make
- Компилятор СИ

<br>

**Инструкция по установке:**
1) Устанавливаем все необходимые утилиты из списка "Необходимое ПО"
2) Проверяем, что все программмы установились корректно
3) Скачиваем tar архив с официального сайта
    - Заходим в реестр исходных кодов PostgreSQL
        ```
        https://www.postgresql.org/ftp/source/
        ```
    - Выбираем нужную для нас версию и переходим в соответствующую директорию
    - Копируем адрес файла именно на ftp сервере и используем утилиту curl или wget
        ```
        curl -O https://ftp.postgresql.org/pub/source/v16.0/postgresql-16.0.tar.gz
        ```
        ```
        wget https://ftp.postgresql.org/pub/source/v16.0/postgresql-16.0.tar.gz
        ```
4) Распаковываем архив
    ```
    tar xzfv postgresql-16.0.tar.gz  
    ```
5) Переходим в директорию с исходным кодом
    ```
    cd postgresql-16.0
    ```
6) Запускам исполняемый файл *configure* с указанием директории для установки архитектурно-независимых файлов и порта
    ```
    ./configure --prefix=/home/forza/pgsql16 --with-port=5555
    ```
7) С помощью утилиты make собираем и устанавливаем сервер
    - make - обычная сборка сервера
    - make world - сборка сервера, а также всех расширений и документации
    - make install - производим установку сервера в папку, которая была указана с флагом --prefix
8) Переходим в папку с установленным сервером и создаем в ней папку data. После чего экспортируем две важные переменные окружения
    ```
    export PGDATA=/home/forza/pgsql16/data
    ```
    ```
    export PATH=/home/forza/pgsql16/bin:$PATH
    ```
    - Переменная PGDATA будет хранить в себе путь к директории, в которой будут храниться все основные файлы кластера баз данных PostgreSQL
    - Переменную PATH мы должны `обновить, а не перезаписать`. В нее мы добавим путь к директории с исполняемыми файлами (приложения) PostgreSQL
9) Инициализируем кластер баз дыннх с помощью только что установленной утилиты initdb
    ```
    initdb -U postgres -k -D /home/forza/pgsql16/data
    ```
    - Ключ -U указывает имя пользоватлея, который может подключаться к БД
    - Ключ -k означает включение подсчета контрольных сумм. Это помогает на ранних стадиях обнаружить повреждение секций данных
    - Ключ -D нужен для того, чтобы указать директорию с файлами кластера баз данных. В случае, если переменная PGDATA уже создана, то этот ключ можно не использовать
10) Запускам сервер PostgreSQL
    ```
    pg_ctl start -l /home/forza/pgsql16/logs/start_log.log
    ```
11) Используем библиотеку psql, чтобы подключиться к серверу и сделать простой запрос
    ```
    psql -U postgres -p 5555 -c 'SELECT now();'
    ```
12) Останавливаем сервер
    ```
    pg_ctl stop -m fast
    ```

<br>

### Установка PostgreSQL с помощью установочного пакета (Ubuntu)

**Инструкция по установке:**

1) Обновляем список системных пакетов
    ```
    sudo apt-get update
    ```
2) Устанавливаем нужные системные пакеты по обновленному списку
    ```
    sudo apt-get upgrade
    ```
3) Устанавливаем пакет postgresql
    ```
    sudo apt-get install -y postgresql
    ```

- Директория установки: /usr/lib/postgresql/14
    - /bin - директория исполняемых файлов PostgreSQL
    - /lib - директория с библиотеками 

- Директория кластера баз данных: /var/lib/postgresql/14/main

- Директория с логами сервера: /var/log/postgresql

- Cервер и его ПО при установке принадлежит пользователю `root`

- Файлы кластера баз данных принадлежит созданному пользователю `postgres`


<br>

**Некоторые команды по управлению кластером баз данных:**

- Запустить кластур баз данных
    ```
    sudo pg_ctlcluster 14 main start
    ```
- Остановить кластер баз данных
    ```
    sudo pg_ctlcluster 14 main stop
    ```
- Перезапустить кластер баз данных с новой конфигурацией
    ```
    sudo pg_ctlcluster 14 main reload
    ```
- Проверить статус кластера
    ```
    sudo pg_ctlcluster 14 main status
    ```
